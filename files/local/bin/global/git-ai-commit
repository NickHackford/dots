#!/usr/bin/env bash

# Determine the correct opencode command (dvx wrapper for HubSpot auth or direct)
if command -v dvx &>/dev/null; then
    OPENCODE_CMD="dvx opencode"
else
    OPENCODE_CMD="opencode"
fi

# Get staged changes
staged_diff=$(git diff --cached)

# Check if there are any staged changes
if [ -z "$staged_diff" ]; then
    echo "No staged changes to commit"
    exit 1
fi

# Generate commit message using Claude
commit_message=$(echo "$staged_diff" | $OPENCODE_CMD "run" "Generate a concise commit message for these staged changes. Return only the commit message, no explanations or formatting. Prefix all commit messages with one of the following, feat(*APP*): , bug(*APP*):, tweak(*APP*):, chore(*APP*):, where *APP* is the program we are modifying. Chore is basically only for updates, otherwise use another prefix")

# Commit with the generated message
git commit -m "$commit_message"
