#!/usr/bin/env bash

# Get current session info
current_session=$(tmux display-message -p '#S')
current_path=$(tmux display-message -p '#{session_path}')

# Extract base name (remove numeric suffix if it exists)
base_name=$(echo "$current_session" | sed 's/[0-9]*$//')

# Find next available session number
counter=2
while tmux has-session -t "${base_name}${counter}" 2>/dev/null; do
    ((counter++))
done

new_session="${base_name}${counter}"

# Create new session in same directory
if ! tmux has-session -t="$new_session" 2>/dev/null; then
    tmux new-session -ds "$new_session" -c "$current_path"
fi

# Switch to new session
tmux switch-client -t "$new_session"
